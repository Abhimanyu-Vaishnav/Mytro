<!-- SUGGESTIONS COMPONENT -->
<div class="suggestions-card">
    <div class="suggestions-header">
        <h3 class="suggestions-title">People to Follow</h3>
        <button class="refresh-suggestions" onclick="refreshSuggestions()" title="Refresh suggestions">
            <i class="fas fa-sync-alt"></i>
        </button>
    </div>
    
    <div class="suggestions-list" id="suggestionsList">
        {% for suggested_user in suggestions %}
        <div class="suggestion-item" data-user-id="{{ suggested_user.id }}">
            <div class="suggestion-user-info">
                <a href="{% url 'profile' suggested_user.username %}" class="suggestion-avatar-link">
                    {% if suggested_user.profile.profile_pic %}
                        <img src="{{ suggested_user.profile.profile_pic.url }}" alt="{{ suggested_user.username }}" class="suggestion-avatar" />
                    {% else %}
                        <div class="avatar-fallback">{{ suggested_user.username|first|upper }}</div>
                    {% endif %}
                </a>
                
                <div class="suggestion-details">
                    <a href="{% url 'profile' suggested_user.username %}" class="suggestion-name">
                        {% if suggested_user.get_full_name %}
                            {{ suggested_user.get_full_name }}
                        {% else %}
                            {{ suggested_user.username }}
                        {% endif %}
                    </a>
                    <span class="suggestion-username">@{{ suggested_user.username }}</span>
                    <span class="suggestion-mutual">5 mutual friends</span>
                </div>
            </div>
            
            <button class="follow-btn {% if suggested_user in user.profile.following.all %}following{% endif %}" 
                    onclick="followUser({{ suggested_user.id }}, this)">
                {% if suggested_user in user.profile.following.all %}
                    <i class="fas fa-user-check"></i> Following
                {% else %}
                    <i class="fas fa-user-plus"></i> Follow
                {% endif %}
            </button>
        </div>
        {% empty %}
        <div class="empty-suggestions">
            <i class="fas fa-users"></i>
            <p>No suggestions available</p>
            <button class="btn-secondary" onclick="refreshSuggestions()">Refresh</button>
        </div>
        {% endfor %}
    </div>
    
    <div class="suggestions-footer">
        <a href="#" class="see-more-link">See More Suggestions</a>
    </div>
</div>

<!-- TRENDING HASHTAGS -->
<div class="suggestions-card">
    <div class="suggestions-header">
        <h3 class="suggestions-title">Trending Topics</h3>
    </div>
    <div class="suggestions-list">
        <div class="trending-item">
            <span class="hashtag-icon">#</span>
            <div class="trend-info">
                <strong class="trend-name">QuickTrust</strong>
                <span class="trend-stats">245 posts</span>
            </div>
        </div>
        <div class="trending-item">
            <span class="hashtag-icon">#</span>
            <div class="trend-info">
                <strong class="trend-name">StartingSmart</strong>
                <span class="trend-stats">189 posts</span>
            </div>
        </div>
        <div class="trending-item">
            <span class="hashtag-icon">#</span>
            <div class="trend-info">
                <strong class="trend-name">Mytro</strong>
                <span class="trend-stats">156 posts</span>
            </div>
        </div>
    </div>
    <div class="suggestions-footer">
        <a href="#" class="see-more-link">Show More</a>
    </div>
</div>

<script>
async function followUser(userId, button) {
    console.log('followUser called with:', userId, button);
    
    if (button.disabled) return;
    
    button.disabled = true;
    const originalHTML = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Loading...';
    
    try {
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]')?.value || 
                         document.cookie.split('; ').find(row => row.startsWith('csrftoken='))?.split('=')[1];
        
        console.log('CSRF Token:', csrfToken);
        console.log('Making request to:', `/api/follow/${userId}/`);
        
        const response = await fetch(`/api/follow/${userId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': csrfToken,
                'Content-Type': 'application/json'
            }
        });
        
        console.log('Response status:', response.status);
        const responseText = await response.text();
        console.log('Response text:', responseText);
        
        if (response.ok) {
            const data = JSON.parse(responseText);
            console.log('Response data:', data);
            
            if (data.is_following) {
                button.innerHTML = '<i class="fas fa-user-check"></i> Following';
                button.classList.add('following');
                if (window.showGlobalNotification) {
                    window.showGlobalNotification('Now following user', 'success');
                }
            } else {
                button.innerHTML = '<i class="fas fa-user-plus"></i> Follow';
                button.classList.remove('following');
                if (window.showGlobalNotification) {
                    window.showGlobalNotification('Unfollowed user', 'success');
                }
            }
        } else {
            console.error('Request failed:', response.status, responseText);
            button.innerHTML = originalHTML;
            if (window.showGlobalNotification) {
                window.showGlobalNotification('Failed to update follow status', 'error');
            } else {
                alert('Failed to update follow status');
            }
        }
    } catch (error) {
        console.error('Follow error:', error);
        button.innerHTML = originalHTML;
        if (window.showGlobalNotification) {
            window.showGlobalNotification('Network error', 'error');
        } else {
            alert('Network error');
        }
    } finally {
        button.disabled = false;
    }
}

function refreshSuggestions() {
    location.reload();
}

// Hover effects
document.addEventListener('DOMContentLoaded', function() {
    const suggestionItems = document.querySelectorAll('.suggestion-item');
    suggestionItems.forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.style.transform = 'translateX(5px)';
        });
        
        item.addEventListener('mouseleave', function() {
            this.style.transform = 'translateX(0)';
        });
    });
});
</script>